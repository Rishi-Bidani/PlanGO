<!DOCTYPE html>
<html lang="en">
	<head>
		<title>PlanGO</title>

		<link rel="stylesheet" href="static/sidenav.css" />

		<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
			integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
			crossorigin="anonymous"
		/>
		<script
			type="text/javascript"
			src="https://www.gstatic.com/charts/loader.js"
		></script>

		<link rel="stylesheet" href="static/taskgrid.css" />

		<style>
			body {
				background-color: #1d2632;
			}
			.centertitle {
				text-align: center;
				color: white;
				margin-left: 150px;
			}
			.levelup {
				margin-left: 150px;
				height: 11vh;
				grid-row: 1;
				grid-column: 1;
			}
			.progress-level {
				margin-left: 200px;
				width: 30vw;
				grid-row: 1;
				grid-column: 2;
				margin-top: 4.5vh;
				z-index: -1;
			}
			#levelgrid {
				display: grid;
				grid-template-columns: 0vw 30vw 50vw;
				grid-template-rows: 100%;
			}
			#maintitle {
				grid-column: 3;
				grid-row: 1;
				margin-top: 2vh;
				margin-left: 0px;
			}
			#expenses {
				display: grid;
				grid-template-rows: 5% 5% 60%;
				grid-template-columns: 30vw 25vw 30vw;
			}
			#piechart {
				grid-column: 1;
				grid-row: 2;
				margin-top: 20vh;
				margin-left: 1vw;
			}
			@media only screen and (max-height: 600px){
				#piechart{
					margin-top: 10vh;
				}
			}
			#col1{
				grid-row: 1;
				grid-column: 1;
			}
			table{
				text-align: left;
				margin-left: 5vw;
				border: white;
				margin-top: 200px;
			}
			td{
				padding-right: 40px;
			}
			h1{
				font-size: 5vh;
			}
			h2{
				font-size: 3.5vh;
			}
			h3{
				font-size: 3vh;
			}
			h4{
				font-size: 2.5vh;
			}
			svg > g > g:last-child { pointer-events: none }
		</style>
	</head>
	<body>
		<div class="sidebar">
			<a href="#home" class="nava" id="homebtn" onclick="showhome()">Home</a>
			<a href="#tasks" class="nava" id="taskbtn" onclick="showtasks()">Tasks</a>
			<a href="#contact" class="nava">TimeTable</a>
			<a href="#about" class="nava">Quick notes</a>
			<a href="#about" class="nava" id="expensesbtn" onclick="showExpenses()"
				>Expenses
			</a>
		</div>

		<div id="levelgrid">
			<img src="assets/star.png" alt="star" class="levelup" />
			<div class="progress progress-level">
				<div class="progress-bar bg-warning" id="level" style="width: 0%"></div>
			</div>
			<div id="maintitle">
				<h1 class="centertitle" style="margin-left: 0px" id="title">Default</h1>
			</div>
		</div>

		<div id="home" class="screen centertitle" style="display: none">
			<!-- <h1>Home</h1> -->
		</div>

		<div
			id="tasks"
			class="screen centertitle"
			style="display: none; margin-right: 100px"
		>
			<!-- <h1>Tasks</h1> -->
			<br />
			<div class="container" id="time">
				<div class="container" id="todaycol">
					<h2>Today's Tasks</h2>

					<div
						class="container"
						id="today"
						style="border: 3px solid white; border-radius: 20px"
					>
						<ul id="t"></ul>
					</div>
				</div>

				<div class="container" id="weekcol">
					<h2>This Week's Tasks</h2>

					<div
						class="container"
						id="week"
						style="border: 3px solid white; border-radius: 20px"
					>
						<ul id="tw"></ul>
					</div>
				</div>
			</div>
		</div>


		<!-- Expense manager View -->

		<div
			id="expense"
			class="screen centertitle"
			style="display: none;"
		>
		<div id="expenses">
			<div id="Ecolumn1">
				<div>
					<table>
					<tr>
					<td><h4 id="col1"><u>Money Spent On Items:</u></h4></td>
					
					</tr>
						<tr>
							<td>Food</td>
							<td id="foodValue">0</td>
						</tr>
						<tr>
							<td>
								Education
							</td>
							<td id="EduValue" >
								0
							</td>
						</tr>
						<tr>
							<td>Commute</td><td id="CommuteValue">0</td>
						</tr>
						<tr>
							<td>Phone Bills</td><td id="pbValue">0</td>
						</tr>
						<tr>
							<td>Other Bills</td><td id="obValue">0</td>
						</tr>
						<tr>
							<td>Miscellaneous</td>
							<td id="MiscValue">0</td>
						</tr>
					</table>
				</div>
				<div id="piechart" class="alignpie" style="z-index: -40;"></div>
			</div>
		
			<div id="Ecolumn2" style="z-index: 10;">
				<p>
					<h3>This Months Budget:</h3>
					<h3 id="monthlybudget">0</h3><button class="btn btn-primary" id="refresh" onclick="restart">Refresh</button>
				</p>
				<p>
					<h3>This Months Expenditure: </h3>
					<h3 id="monthexpen">0</h3>
				</p>
			</div>
		
			<div id="Ecolumn3">
					<div class="container" id="monthlypay">
						<h2>Monthly Payments</h2>
			
						<div
							class="container"
							id="monthly"
							style="border: 3px solid white; border-radius: 20px"
						>
							<ul id="monthlyList"></ul>
						</div>
					</div>
			
					<div class="container" id="annualpay">
						<h2>Annual payments</h2>
			
						<div
							class="container"
							id="annual"
							style="border: 3px solid white; border-radius: 20px"
						>
							<ul id="annualList"></ul>
						</div>
					</div>
			</div>
		</div>
		</div>

		<script>
			const path = require("path");
			const electron = require("electron");
			const { ipcRenderer } = electron;
			const fs = require('fs');
			var jsonData = require('./budget.json');
			// Screens bellow ------------------------------------------
			let allscreens = document.getElementsByClassName("screen");
			let task = document.getElementById("tasks");
			let home = document.getElementById("home");
			let main = document.getElementById("main");

			// Title ----------------------------------------------------
			let title = document.getElementById("title");

			// Buttons bellow --------------------------------------------
			let taskbtn = document.getElementById("taskbtn");
			let homebtn = document.getElementById("homebtn");
			let expensesbtn = document.getElementById("expensesbtn");


			// level stuff
			function level(){
				let xplevel = document.getElementById("level")
				if(jsonData.experience <= 10){
					w = jsonData.experience*10;
					xplevel.style.width = `${w}%`;
				}
			}

			level();

			nav = [taskbtn, homebtn, expensesbtn];

			function showtasks() {
				for (var i = 0; i < allscreens.length; i++) {
					allscreens[i].style.display = "none";
				}
				for (var i = 0; i < nav.length; i++) {
					nav[i].className = "";
				}
				title.innerHTML = "Tasks";
				task.style.display = "block";
				taskbtn.className = "active";
			}

			function showhome() {
				for (var i = 0; i < allscreens.length; i++) {
					allscreens[i].style.display = "none";
				}
				for (var i = 0; i < nav.length; i++) {
					nav[i].className = "";
				}

				title.innerHTML = "Home";
				home.style.display = "block";
				homebtn.className = "active";
			}

			function showExpenses() {
				for (var i = 0; i < allscreens.length; i++) {
					allscreens[i].style.display = "none";
				}

				for (var i = 0; i < nav.length; i++) {
					nav[i].className = "";
				}
				title.innerHTML = "Expenses";
				expense.style.display = "block";
				expensesbtn.className = "active";

				var jsonData = require('./budget.json');
				console.log(jsonData)
				var budget = document.getElementById("monthlybudget");
				let expen = document.getElementById("monthexpen");

				budget.innerHTML = jsonData.budget;
				expen.innerHTML = jsonData.expenditure;

				
				var foodValue = document.getElementById("foodValue")
				var eduValue = document.getElementById("EduValue")
				var commuteValue = document.getElementById("CommuteValue")
				var pbValue = document.getElementById("pbValue")
				var obValue = document.getElementById("obValue")
				var miscValue = document.getElementById("MiscValue")
				foodValue.innerHTML = jsonData.food;
				eduValue.innerHTML = jsonData.education;
				commuteValue.innerHTML = jsonData.commute;
				pbValue.innerHTML = jsonData.phonebill;
				obValue.innerHTML = jsonData.otherbills;
				miscValue.innerHTML = jsonData.miscellaneous;
			}
		
			ipcRenderer.on("item:task", function (e, item) {
				const ul2 = document.getElementById("tw");
				ul.innerHTML = "";
				ul.className = "";
				ul2.innerHTML = "";
				ul2.className = "";
				for (var i = 0; i < item.length; i++) {
					// console.log(item[i].task);
					let ul = "";

					if (item[i].time == "today") {
						ul = document.getElementById("t");
					} else {
						ul = document.getElementById("tw");
					}
					const li = document.createElement("li");
					ul.className = "collection";
					li.className = "collection-item";

					const itemText = document.createTextNode(item[i].task);

					li.appendChild(itemText);
					ul.appendChild(li);
				}
				// showtasks();
			});

			// //Remove Items
			const ul = document.querySelector("ul");
			const ul2 = document.getElementById("tw");

			const li = document.createElement("li");

			ul.addEventListener("dblclick", removeItem);
			ul2.addEventListener("dblclick", removeItem);

			function removeItem(e) {
				// var myVal = e.target.innerHTML;
				// console.log(myVal);
				e.target.remove();
				if (ul.children.length == 0) {
					ul.className = "";
					level();
				}
				ipcRenderer.send("item:toDelete", e.target.innerHTML);
			}

			// Google Charts

			google.charts.load("current", { packages: ["corechart"] });
			google.charts.setOnLoadCallback(drawChart);

			function drawChart() {
				var data = google.visualization.arrayToDataTable([
					["Task", "Hours per Day"],
					["Food", jsonData.food],
					["Education", jsonData.education],
					["commute", jsonData.commute],
					["Phone bill", jsonData.phonebill],
					["Other bills", jsonData.otherbills],
					["Miscellaneous", jsonData.miscellaneous]
				]);

				var options = {
					title: "My Daily Activities",
					backgroundColor: "#1d2632",
					chartArea: { width: 400, height: 300 },
					legend: { textStyle: { color: "white" } },
				};

				var chart = new google.visualization.PieChart(
					document.getElementById("piechart")
				);

				chart.draw(data, options);
			}
			function restart(){
				ipcRenderer.send("restart:budget", "refresh")
				showExpenses();
			}
			ipcRenderer.on("budget:restart", function(e, item){
				console.log(item);
				showExpenses();
			})

			ipcRenderer.on("which:page", function(e, item){
				console.log(item);
				if(item=="expenses"){
					showExpenses();
				}else{
					showtasks();
				}
			})
			ipcRenderer.on("monthly:budget", function(e, item){
				let expen = document.getElementById("monthexpen");
				expen.innerHTML = item
			})

			document.getElementById("refresh").onclick = restart;


		</script>

		<div class="centertitle screen" id="main">
			<h1>This</h1>
		</div>
	</body>
</html>


